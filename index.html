<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Volunteer Matching System</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header>
        <h1>Events</h1>
        <input type="text" name="event" id="event-input" placeholder="🔍">
        <div>
            <p id="org-name">Spain Co.</p>
            <img src="images/profile.jpeg" alt="org-profile" id="org-profile" class="profile">
        </div>
    </header>
    <nav>
        <a href="index.html">Home</a>
        <a href="">New Volunteers</a>
        <a href="new-event.html">Create New</a>

    </nav>
    <section id="event-list">
        <section class="new-event" id="new-event">
            <p class="plus-mark">+</p>
            <p>creat event</p>
        </section>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="js/eventData.js"></script>
    <script>
        checkLocalStorage();
        const eventList = document.getElementById("event-list");
        const orgName = document.getElementById("org-name").innerHTML;
        const localEventData = JSON.parse(localStorage.getItem("eventData"));
        localEventData.forEach(event => {
            if (orgName == event.owner) {
                console.log("true");
                const eventSec = document.createElement("section");
                const coverDiv = document.createElement("div");
                const eventCover = document.createElement("img");
                eventCover.setAttribute("src", event.cover);
                coverDiv.append(eventCover);

                const iconDiv = document.createElement("div");

                const humanIcon = document.createElement("img");
                humanIcon.setAttribute("src", "images/human.svg");
                humanIcon.setAttribute("width", "36px");
                humanIcon.setAttribute("height", "36px");
                humanIcon.setAttribute("data-link", event.id);
                humanIcon.className = "humanIcon";

                const editIcon = document.createElement("img");
                editIcon.setAttribute("src", "images/cog.svg");
                editIcon.setAttribute("data-link", event.id);
                editIcon.setAttribute("width", "36px");
                editIcon.setAttribute("height", "36px");
                editIcon.className = "editIcon";

                const deletIcon = document.createElement("img");
                deletIcon.setAttribute("src", "images/bin.svg");
                deletIcon.setAttribute("data-link", event.id);
                deletIcon.setAttribute("width", "36px");
                deletIcon.setAttribute("height", "36px");
                deletIcon.className = "deletIcon";

                iconDiv.append(humanIcon, editIcon, deletIcon);
                iconDiv.className = "icon-div";
                coverDiv.append(iconDiv);
                coverDiv.className = "cover-div";
                const eventTitle = document.createElement("h3");
                eventTitle.innerHTML = event.title;
                const eventPlace = document.createElement("p");
                eventPlace.innerHTML = event.location;
                const eventTime = document.createElement("p");
                eventTime.innerHTML = event.timeStart;
                eventSec.append(coverDiv, eventTitle, eventPlace, eventTime);
                eventSec.className = "event-sec";
                eventList.append(eventSec);
            }
        });

        $("#new-event").click(function () {
            window.location.href = 'new-event.html';
        });

        $(".humanIcon").click(function() {
            window.location.href = `volunteer-list.html?id=${$(this).attr("data-link")}`;
        })

        $(".editIcon").click(function () {
            window.location.href = `new-event.html?id=${$(this).attr("data-link")}`;
        });

        $(".deletIcon").click(function () {
            if (confirm("Do you really want to delet it?")) {
                const id = $(this).attr("data-link");
                for (let i = 0; i < localEventData.length; i++) {
                    if (localEventData[i].id == id) {
                        localEventData.splice(i,1);
                        console.log(localEventData);
                        localStorage.setItem("eventData", JSON.stringify(localEventData));
                        window.location.reload();
                    }
                }
            }
        })
    </script>
</body>

</html>